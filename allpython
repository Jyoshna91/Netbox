from pyats.topology import loader

# Load the testbed file
testbed = loader.load("testbed.yaml")

# Connect to all devices
for device_name, device in testbed.devices.items():
    print(f"\nConnecting to {device_name}...")
    try:
        device.connect()
        print(f"Connected to {device_name}.")

        # Execute show commands
        show_version_output = device.execute("show version")
        print(f"\n### {device_name} - Show Version ###\n")
        print(show_version_output)

        show_interfaces_output = device.execute("show ip interface brief")
        print(f"\n### {device_name} - Show IP Interface Brief ###\n")
        print(show_interfaces_output)

        # Disconnect after executing commands
        device.disconnect()
        print(f"Disconnected from {device_name}.")

    except Exception as e:
        print(f"Failed to connect or execute commands on {device_name}: {str(e)}")
